<?php
    
?>

<table cellpadding="9" cellspacing="0">
<tr>
	<td align="right"><?php print_string('livedeskref', 'block_livedesk') ?></td>
	<td><?php print_reference_pluginsselect($this->instance->id); ?></td>
</tr>

<tr>
	<td></td>
	<td>
<?php
	$location = $CFG->wwwroot."/blocks/livedesk/edit.php?livedeskid=0";
	
	$system_context = get_context_instance(CONTEXT_SYSTEM,1);
	if(has_capability('block/livedesk:createlivedesk', $system_context)){ 
		print('<input type="button" name="create_new_instance" value="'.get_string('createnewinstance', 'block_livedesk').'" onClick="window.location=\''.$location.'\'"  />');
	}
?>
	</td>
</tr>
<tr>
    <td colspan="3" align="center">
    <input type="submit" value="<?php print_string('savechanges') ?>" /></td>
</tr>
</table>

<?php 

/**
* prints the plugin selector
*/
function print_reference_pluginsselect($blockid){
    
    //get existing reference 

    $reference = get_record('block_livedesk_blocks', 'blockid', $blockid);
    $livedesk_instanceid = null;
    if(@$reference){
     	$livedesk_instanceid = $reference->livedeskid;
    }

	/*   
    if(!empty($livedesk_instances)){
     	$select = "<select name=\"livedesk_instance\">";
    	foreach($livedesk_instances as $instance){
       		$select .= "<option value=\"".$instance->id."\" ".(($instance->id==$livedesk_instanceid)?' selected':'')." >".$instance->name."</option>"; 
    	}
    	$select .= "</select>";
    } else {    
    	$select = notify(get_string('noreference', 'block_livedesk'), 'notifyproblem', 'left', true);
    }
    print($select);
    */

    $livedeskinstancesmenu = get_records_menu('block_livedesk_instance', '', '', 'id,name');

	if ($livedeskinstancesmenu){
		choose_from_menu($livedeskinstancesmenu, 'livedesk_instance', $livedesk_instanceid);
	} else {
		notify(get_string('noreference', 'block_livedesk'), 'notifyproblem', 'left');
	}
}

/**
*
*
*/  
function get_livedesk_type(){
}
  
  

?>
