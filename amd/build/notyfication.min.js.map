{"version":3,"file":"notyfication.min.js","sources":["../src/notyfication.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Javascript controller for controlling the sections.\n *\n * @module     block_livedesk/notyfication\n * @package    blocks\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n// jshint unused: true, undef:false\n// global dhtmlXCalendarObject\n/* eslint-disable no-undef */\ndefine(['jquery', 'core/config', 'core/str', 'core/log'], function ($, cfg, str, log) {\n\n    var ldskn;\n\n    ldskn = {\n\n        params: null,\n\n        init: function(params) {\n\n            ldskn.params = params;\n\n            var stringdefs = [\n                {key:'newmessages', component:'block_livedesk'}\n            ];\n\n            str.get_strings(stringdefs).done(function(s) {\n                ldskn.strs = s;\n            });\n\n            log.debug('AMD Block Livedesk Notyfication initialized');\n\n        },\n\n        start: function() {\n            setInterval(ldskn.get_unnotified_messages, ldskn.params['notification_refresh_time']);\n            log.debug('AMD Block Livedesk Notifycation started');\n        },\n\n        get_unnotified_messages: function() {\n            var url = cfg.wwwroot + '/blocks/livedesk/ajax/service.php?';\n            url += 'action=get_unnotified_messages&';\n            url += 'course=' + ldskn.params['courseid'];\n\n            $.post(url, function(data) {\n\n                if (data == '') {\n                    return;\n                }\n\n                if (Noty !== undefined) {\n                    Noty.closeAll();\n                }\n                var dataarr = JSON.parse(data);\n\n                for (var key = 0 ; key < dataarr.length ; key++) {\n                       var id = dataarr[key].id;\n                       var message = dataarr[key].message;\n                       var notification = '<input name=\"noty_id' + id;\n                       notification += '\" type=\"hidden\" value=' + id + ' class=\"noty_message_num\" />';\n                       notification += '<b>' + ldskn.strs[0] + '</b>';\n                       notification += '<div>' + message + '</div>';\n                       ldskn.generateNoty(notification, 'information', id);\n                }\n            });\n        },\n\n        generateNoty: function (text, type) {\n            var n = new Noty({\n                text: text,\n                timeout: ldskn.params['notification_onscreen_time'],\n                closeWith: ['button'],\n                type: type,\n                dismissQueue: true,\n                layout: ldskn.params['layout'],\n                theme: ldskn.params['theme']\n            }).show();\n            return n;\n        },\n    };\n\n    return ldskn;\n});\n"],"names":["define","$","cfg","str","log","ldskn","params","init","get_strings","key","component","done","s","strs","debug","start","setInterval","get_unnotified_messages","url","wwwroot","post","data","undefined","Noty","closeAll","dataarr","JSON","parse","length","id","message","notification","generateNoty","text","type","timeout","closeWith","dismissQueue","layout","theme","show"],"mappings":";;;;;;;AAyBAA,qCAAO,CAAC,SAAU,cAAe,WAAY,aAAa,SAAUC,EAAGC,IAAKC,IAAKC,SAEzEC,aAEJA,MAAQ,CAEJC,OAAQ,KAERC,KAAM,SAASD,QAEXD,MAAMC,OAASA,OAMfH,IAAIK,YAJa,CACb,CAACC,IAAI,cAAeC,UAAU,oBAGNC,MAAK,SAASC,GACtCP,MAAMQ,KAAOD,KAGjBR,IAAIU,MAAM,gDAIdC,MAAO,WACHC,YAAYX,MAAMY,wBAAyBZ,MAAMC,OAAN,2BAC3CF,IAAIU,MAAM,4CAGdG,wBAAyB,eACjBC,IAAMhB,IAAIiB,QAAU,qCACxBD,KAAO,kCACPA,KAAO,UAAYb,MAAMC,OAAN,SAEnBL,EAAEmB,KAAKF,KAAK,SAASG,SAEL,IAARA,WAISC,IAATC,MACAA,KAAKC,mBAELC,QAAUC,KAAKC,MAAMN,MAEhBZ,IAAM,EAAIA,IAAMgB,QAAQG,OAASnB,MAAO,KACtCoB,GAAKJ,QAAQhB,KAAKoB,GAClBC,QAAUL,QAAQhB,KAAKqB,QACvBC,aAAe,uBAAyBF,GAC5CE,cAAgB,yBAA2BF,GAAK,+BAChDE,cAAgB,MAAQ1B,MAAMQ,KAAK,GAAK,OACxCkB,cAAgB,QAAUD,QAAU,SACpCzB,MAAM2B,aAAaD,aAAc,cAAeF,UAK/DG,aAAc,SAAUC,KAAMC,aAClB,IAAIX,KAAK,CACbU,KAAMA,KACNE,QAAS9B,MAAMC,OAAN,2BACT8B,UAAW,CAAC,UACZF,KAAMA,KACNG,cAAc,EACdC,OAAQjC,MAAMC,OAAN,OACRiC,MAAOlC,MAAMC,OAAN,QACRkC,QAMd"}