{"version":3,"file":"livedeskinit.min.js","sources":["../src/livedeskinit.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Javascript controller for controlling the sections.\n *\n * @module     block_livedesk/notification\n * @package    blocks\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n// jshint unused: true, undef:false\n// global dhtmlXCalendarObject\n/* eslint-disable no-undef */\ndefine(['jquery', 'core/config', 'core/str', 'core/log'], function ($, cfg, str, log) {\n\n    var livedesk = {\n\n        dhxWins: '',\n\n        selectedRow: 0,\n\n        menu: null,\n\n        toolbar: null,\n\n        mygrid: null,\n\n        init: function(params) {\n\n            var url;\n            livedesk.dhxWins = new dhtmlXWindows();\n            livedesk.selectedRow = null;\n\n            livedesk.params = params;\n            livedesk.strs = [];\n\n            var stringdefs = [\n                {key: 'reply', component:'block_livedesk'},  // 0\n                {key: 'discard', component:'block_livedesk'}, // 1\n                {key: 'discardbefore', component:'block_livedesk'}, // 2\n                {key: 'emailuser', component:'block_livedesk'}, // 3\n                {key: 'message', component:'block_livedesk'}, // 4\n                {key: 'user', component:'block_livedesk'}, // 5\n                {key: 'messagetime', component:'block_livedesk'}, // 6\n                {key: 'origin', component:'block_livedesk'}, // 7\n                {key: 'lockedby', component:'block_livedesk'}, // 8\n                {key: 'livequeue', component:'block_livedesk'}, // 9\n                {key: 'livedeskinfo', component:'block_livedesk'}, // 10\n                {key: 'onlineusers', component:'block_livedesk'}, // 11\n                {key: 'monitoredplugins', component:'block_livedesk'}, // 12\n                {key: 'refreshposts', component:'block_livedesk'}, // 13\n                {key: 'onlineuserscount', component:'block_livedesk'}, // 14\n                {key: 'onlineattenderscount', component:'block_livedesk'}, // 15\n                {key: 'showhideanswered', component:'block_livedesk'}, // 16\n                {key: 'showhidediscarded', component:'block_livedesk'}, // 17\n                {key: 'showhidelocked', component:'block_livedesk'}, // 18\n                {key: 'configurations', component:'block_livedesk'}, // 19\n                {key: 'statistics', component:'block_livedesk'}, // 20\n                {key: 'managelivedesks', component:'block_livedesk'}, // 21\n            ];\n\n            str.get_strings(stringdefs).done(function(s) {\n                livedesk.strs = s;\n\n                log.debug(JSON.stringify(livedesk.strs));\n                log.debug(JSON.stringify(params));\n\n                log.debug('Start Livedesk construction');\n\n                // Menu.\n                livedesk.menu = new dhtmlXMenuObject();\n                livedesk.menu.setIconsPath('pix/');\n                livedesk.menu.setSkin('dhx_web');\n                livedesk.menu.renderAsContextMenu();\n\n                // initing;\n                livedesk.menu.addNewChild(null, 1, \"reply_post\", livedesk.strs[0], false, 'reply_mail.png');\n                livedesk.menu.addNewChild(null, 2, \"discard_post\", livedesk.strs[1], false, \"discard_mail.png\");\n                livedesk.menu.addNewChild(null, 3, 'discard_posts_before', livedesk.strs[2], false, \"discard_mail.png\");\n                livedesk.menu.addNewChild(null, 4, 'send_email', livedesk.strs[3], false, \"mail.png\");\n\n                // Context menu event.\n                livedesk.menu.attachEvent('onClick', livedesk.onContextMenuClick);\n\n                log.debug('Start Grid construction');\n\n                // Init Grid\n                livedesk.mygrid = new dhtmlXGridObject('livedesk-postsgrid');\n                livedesk.mygrid.setImagePath('js/dhtmlx/3.0/dhtmlxGrid/codebase/imgs/'); // Â¨Path to images required by grid.\n                var headers = \"#,,\" + livedesk.strs[4] + \",\" + livedesk.strs[5];\n                headers += \",\" + livedesk.strs[6] + \",\" + livedesk.strs[7] + \",\" + livedesk.strs[8];\n                livedesk.mygrid.setHeader(headers); // Set column names.\n                livedesk.mygrid.setInitWidths('30,40,320,100,150,200,*'); // Set column width in px.\n                livedesk.mygrid.setColAlign('right,left,left,left,left,left,left'); // Set column values align.\n                livedesk.mygrid.setColTypes('ro,ro,ro,ro,ro,ro,ro'); // Set column types.\n                livedesk.mygrid.setColSorting('int,str,str,str,str,str,str'); // Set sorting.\n                livedesk.mygrid.init(); // Initialize grid.\n                livedesk.mygrid.setSkin('dhx_web'); // Set grid skin.\n                livedesk.mygrid.enableContextMenu(livedesk.menu);\n\n                log.debug('Loading posts');\n\n                // load all posts.\n                url = cfg.wwwroot + '/blocks/livedesk/ajax/service.php?';\n                url += 'action=load_liveentries&';\n                url += 'bid=' + livedesk.params['bid'];\n                livedesk.mygrid.load(url, 'xml');\n                livedesk.mygrid.attachEvent('onBeforeContextMenu', livedesk.onBeforeContextMenuHandler);\n                livedesk.mygrid.attachEvent('onRowDblClicked', livedesk.onRowDblClicked);\n                livedesk.mygrid.attachEvent('onBeforeContextMenu', livedesk.onBeforeContextMenu);\n\n                log.debug('Creating layout');\n\n                // Setup the layout\n                var layout = new dhtmlXLayoutObject('livedesk-masterlayout', '4C');\n                layout.setSkin('dhx_web');\n\n                layout.cells(\"a\").setWidth(\"800\");\n                layout.cells(\"a\").setHeight(800);\n                layout.cells(\"b\").setWidth(\"250\");\n                layout.cells(\"c\").setWidth(\"250\");\n                layout.cells(\"d\").setWidth(\"250\");\n                layout.cells(\"b\").setHeight(\"90\");\n                layout.cells(\"c\").setHeight(130);\n                layout.cells(\"a\").attachObject(\"livedesk-postsgrid\");\n                layout.cells(\"c\").attachObject(\"livedesk-onlineuserscount\");\n                layout.cells(\"b\").attachObject(\"livedesk-info\");\n                layout.cells(\"d\").attachObject(\"livedesk-plugins\");\n                layout.cells(\"a\").setText(livedesk.strs[9]);\n                layout.cells(\"b\").setText(livedesk.strs[10]);\n                layout.cells(\"c\").setText(livedesk.strs[11]);\n                layout.cells(\"d\").setText(livedesk.strs[12]);\n\n                log.debug('Creating toolbar');\n\n                // Init Toolbar.\n                var toolbar = layout.attachToolbar();\n                toolbar.setIconsPath('pix/');\n                toolbar.setSkin('dhx_web');\n                toolbar.addButton('posts_refresh', 2, livedesk.strs[13], 'refresh.png');\n                var bti = 3;\n                if (livedesk.params['canviewsettings']) {\n                    toolbar.addButton('settings', bti, livedesk.strs[19], 'settings.png', null);\n                    bti++;\n                }\n                if (livedesk.params['canviewstats']) {\n                    toolbar.addButton('view_statistics', bti, livedesk.strs[20], 'statistics.png', null);\n                    bti++;\n                }\n                if (livedesk.params['canmanage']) {\n                    toolbar.addButton('manage_livedesks', bti, livedesk.strs[21], 'manage.png', null);\n                    bti++;\n                }\n                toolbar.addButtonTwoState('show_answered', bti, '', 'show_answered_on.png', 'show_answered_off.png');\n                bti++;\n                toolbar.setItemToolTip('show_answered', livedesk.strs[16]);\n\n                if (livedesk.params['show_answered']) {\n                    toolbar.setItemState('show_answered', true);\n                    toolbar.setItemImage('show_answered', 'show_answered_on.png');\n                } else {\n                    toolbar.setItemState('show_answered', false);\n                    toolbar.setItemImage('show_answered', 'show_answered_off.png');\n                }\n\n                toolbar.addButtonTwoState('show_discarded', bti, '', 'show_discarded_on.png', 'show_discarded_off.png');\n                bti++;\n                toolbar.setItemToolTip('show_discarded', livedesk.strs[17]);\n\n                if (livedesk.params['show_discarded']) {\n                    toolbar.setItemState('show_discarded', true);\n                    toolbar.setItemImage('show_discarded', 'show_discarded_on.png');\n                } else {\n                    toolbar.setItemState('show_discarded', false);\n                    toolbar.setItemImage('show_discarded', 'show_discarded_off.png');\n                }\n\n                toolbar.addButtonTwoState('show_locked', bti, '', 'show_locked_on.png', 'show_locked_off.png');\n                bti++;\n                toolbar.setItemToolTip('show_locked', livedesk.strs[18]);\n\n                if (livedesk.params['show_locked']) {\n                    toolbar.setItemState('show_locked', true);\n                    toolbar.setItemImage('show_locked', 'show_locked_on.png');\n                } else {\n                    toolbar.setItemState('show_locked', false);\n                    toolbar.setItemImage('show_locked', 'show_locked_off.png');\n                }\n\n                toolbar.attachEvent('onClick', livedesk.toolbarClickHandler);\n                toolbar.attachEvent('onStateChange', livedesk.toolbarStateChange);\n                livedesk.toolbar = toolbar;\n\n                // Calendar on the discard messages before page.\n                // var calendar = new dhtmlXCalendarObject('discard_date');\n                livedesk.getMonitoredPlugins();\n                livedesk.refreshOnlineUsersCount();\n\n                // Periodic update.\n                if (livedesk.params['refresh'] > 0) {\n                    log.debug('Installing livedesk updater');\n                    setInterval(function() {\n                        livedesk.refreshGrid();\n                        livedesk.refreshOnlineUsersCount();\n                    }, livedesk.params['refresh']);\n                }\n\n                if (livedesk.params['keepalive'] > 0) {\n                    log.debug('Installing livedesk keepalive signal');\n                    setInterval(function() {\n                        livedesk.keepMeAlive();\n                    }, livedesk.params['keepalive']);\n                }\n\n                $('.noty_message').bind('click', function() {\n                    var related_message_id =  $(this).find('.noty_message_num').val();\n                    if (related_message_id == '') {\n                        return;\n                    }\n                });\n\n                log.debug('Block Livedesk AMD initialized');\n\n            });\n        },\n\n        onBeforeContextMenu: function(id) {\n            livedesk.selectedRow = id;\n            return true;\n        },\n\n        /**\n         * Grid context menu event handles.\n         */\n        onContextMenuClick: function(id) {\n\n            var selId;\n\n            switch (id) {\n                case 'reply_post': {\n                    selId = livedesk.selectedRow;\n                    livedesk.reply_post(selId);\n                    return true;\n                    break;\n                }\n\n                case 'discard_post': {\n                    livedesk.discard_post(livedesk.selectedRow);\n                    break;\n                }\n\n                case 'discard_posts_before': {\n                    var timecreated = livedesk.mygrid.getUserData(livedesk.selectedRow, 'timecreated');\n                    livedesk.dhxWins.createWindow('discard_messages', 400, 100, 400, 130);\n                    livedesk.dhxWins.window('discard_messages').setModal(true);\n                    var discardiconurl = cfg.wwwroot + '/blocks/livedesk/pix/discard_mail.png';\n                    livedesk.dhxWins.window('discard_messages').setIcon(discardiconurl);\n                    livedesk.dhxWins.window('discard_messages').setText(livedesk.strs[2]);\n                    var url = cfg.wwwroot + '/blocks/livedesk/discard_messages_before.php?';\n                    url += 'bid=' + livedesk.params['bid'] + '&';\n                    url += 'date=' + timecreated;\n                    livedesk.dhxWins.window('discard_messages').attachURL(url, true);\n                    return true;\n                    break;\n                }\n            }\n        },\n\n        /**\n        * Event Handlers\n        */\n        onBeforeContextMenuHandler: function (id) {\n            var statusid =  livedesk.mygrid.getUserData(id, 'status_id');\n            if (statusid == 0) {\n                 livedesk.menu.hideItem('disable_post');\n                 livedesk.menu.showItem('enable_post');\n            } else {\n                 livedesk.menu.hideItem('enable_post');\n                 livedesk.menu.showItem('disable_post');\n            }\n            return true;\n        },\n\n        /**\n        * This function handles the toolbar buttons click events.\n        */\n        toolbarClickHandler: function (item) {\n            var url;\n\n            switch(item) {\n                case 'posts_refresh': {\n                    livedesk.refreshGrid();\n                    break;\n                }\n\n                case 'view_statistics': {\n                    var win = livedesk.dhxWins.createWindow('view_statistics', 400, 100, 850, 400);\n                    win.setModal(true);\n                    // dhxWins.window('view_statistics').setModal(true);\n                    var statsiconurl = cfg.wwwroot + '/blocks/livedesk/pix/statistics.png';\n                    win.setIcon(statsiconurl);\n                    // dhxWins.window('view_statistics').setIcon(statsiconurl);\n                    win.setText('Statistics');\n                    // dhxWins.window('view_statistics').setText('Statistics');\n                    var statsurl = cfg.wwwroot + '/blocks/livedesk/statistics.php?';\n                    statsurl += 'bid=' + livedesk.params['bid'];\n                    win.attachURL(statsurl, true);\n                    // dhxWins.window('view_statistics').attachURL(statsurl, true);\n                    return true;\n                }\n\n                case 'settings': {\n                    url = cfg.wwwroot + '/course/view.php?';\n                    url += 'id=' + livedesk.params['courseid'];\n                    url += '&bui_editid=' + livedesk.params['bid'];\n                    url += '&sesskey=' + cfg.sesskey;\n                    window.location = url;\n                    return true;\n                }\n\n                case \"manage_livedesks\": {\n                    url = cfg.wwwroot + '/blocks/livedesk/manage.php';\n                    window.location = url;\n                    return true;\n                }\n            }\n        },\n\n        /*\n        * Sending state to server for SESSION storing and\n        * use in next refreshs.\n        */\n        toolbarStateChange: function (item, state) {\n            if (state) {\n                livedesk.toolbar.setItemImage(item, item + '_on.png');\n            } else {\n                livedesk.toolbar.setItemImage(item, item + '_off.png');\n            }\n            var url = cfg.wwwroot + '/blocks/livedesk/ajax/service.php?';\n            url += 'action=change_state&';\n            url += 'item=' + item + '&';\n            url += 'state=' + state + '&';\n            url += 'bid=' + livedesk.params['bid'];\n            $.post(url, function() {});\n            livedesk.refreshGrid();\n            return true;\n        },\n\n        /**\n        * Refresh the grid.\n        */\n        refreshGrid: function () {\n\n            var url = cfg.wwwroot + '/blocks/livedesk/ajax/service.php?';\n            url += 'action=load_liveentries&';\n            url += 'bid=' + livedesk.params['bid'];\n\n            if (_isIE) { //IE)\n                // var current_rows_count = livedesk.mygrid.getRowsNum();\n                // var fetched_rows_count = 0; //data[rows].length;\n                livedesk.mygrid.clearAndLoad(url, \"xml\");\n            } else { //Other browsers\n                    $.post(url, function(data) {\n                    // var current_rows_count = livedesk.mygrid.getRowsNum();\n                    // var fetched_rows_count = 0; //data[rows].length;\n                    livedesk.mygrid.clearAll();\n                    livedesk.mygrid.parse(data);\n                });\n            }\n\n            return true;\n        },\n\n        /**\n        * Double click event handler\n        */\n        onRowDblClicked: function (rId) {\n            livedesk.reply_post(rId);\n        },\n\n        /**\n         * Initiate the window for replying to new message\n         */\n        reply_post: function (rowId) {\n            var itemid = livedesk.mygrid.getUserData(rowId, 'itemid');\n            var messageid = livedesk.mygrid.getUserData(rowId, 'messageid');\n            var cmid = livedesk.mygrid.getUserData(rowId, 'cmid');\n            var randX = Math.floor(Math.random() * (450 - 350 + 1)) + 350;\n            var randY = Math.floor(Math.random() * (150 - 50 + 1)) + 50;\n            var win = livedesk.dhxWins.createWindow('reply_post' + rowId, randX, randY, 800, 450);\n            win.messageid = messageid;\n            win.closing = false;\n            win.setModal(false);\n            win.setText('Reply');\n            win.attachURL('reply.php?reply=' + itemid + '&cmid=' + cmid, false);\n            livedesk.dhxWins.attachEvent('onClose', livedesk.unlockItem);\n        },\n\n        /**\n         * Generates popup for new incoming messages.\n         */\n        generateNoty: function (text, type) {\n            var n = noty({\n                text: text,\n                timeout: 5000,\n                closeWith: ['button'],\n                type: type,\n                dismissQueue: true,\n                layout: 'bottomRight',\n                theme: 'defaultTheme'\n            });\n            return n;\n        },\n\n        refreshOnlineUsersCount: function () {\n            var url = cfg.wwwroot + '/blocks/livedesk/ajax/service.php?';\n            url += 'action=get_online_users_count&';\n            url += 'bid=' + livedesk.params['bid'];\n\n            $.post(url, function(data) {\n                data = JSON.parse(data);\n\n                var htmlbuffer = '<div class=\"online_users\">';\n                htmlbuffer += '<img src=\"pix/user.png\" /> ';\n                htmlbuffer += livedesk.strs[14] + ' : ' + data.users_count;\n                htmlbuffer += '</div>';\n                $('#livedesk-onlineuserscont').html(htmlbuffer);\n\n                htmlbuffer = '<div class=\"online_users\">';\n                htmlbuffer += '<img src=\"pix/user-black.png\" /> ';\n                htmlbuffer += livedesk.strs[15] + \" : \" + data.attenders_count;\n                htmlbuffer += '</div>';\n                $('#livedesk-onlineuserscount').append(htmlbuffer);\n\n                if (data.attenders_count > 0) {\n                    var userlist = '<ul class=\"livedesk-userlist\">';\n                    for (var i = 0 ; i < data.attenders.length ; i++) {\n                        userlist += '<li class=\"online_users ' + data.attenders[i].className + '\">';\n                        userlist += data.attenders[i].name;\n                        userlist += '</li>';\n                    }\n                    $('#livedesk-onlineuserscount').append(userlist + '</ul>');\n                }\n            });\n        },\n\n        keepMeAlive: function () {\n            var url = cfg.wwwroot + '/blocks/livedesk/ajax/service.php?';\n            url += 'action=keep_me_live&';\n            url += 'bid=' + livedesk.params['bid'] + '&';\n            url += 'livedeskid=' + livedesk.params['livedeskid'] + '&';\n            url += 'courseid=' + livedesk.params['courseid'];\n            $.post(url, function(data) {\n                  $('#livedesk-onlineuserscount').html(livedesk.strs[11] + data);\n            });\n        },\n\n        getMonitoredPlugins: function () {\n\n            var url = cfg.wwwroot + '/blocks/livedesk/ajax/service.php?';\n            url += 'action=get_monitored_plugins&';\n            url += 'livedeskid=' + livedesk.params['livedeskid'] + '&';\n            url += 'bid=' + livedesk.params['bid'];\n            $.post(url, function(data) {\n\n                data = JSON.parse(data);\n\n                $('#livedesk-plugins').html('');\n                var blockpixurl = cfg.wwwroot + '/blocks/livedesk/pix/block.png';\n                var htmlbuffer;\n\n                for (var key in data) {\n                    htmlbuffer = '<div class=\"online_users\">';\n                    htmlbuffer += '<img src=\"' + blockpixurl + '\" />';\n                    var linkurl = cfg.wwwroot + \"/mod/forum/view.php?id=\" + data[key].cmid;\n                    htmlbuffer += \"<a target=\\\"_blank\\\" href=\\\"\" + linkurl + \"\\\" > \";\n                    htmlbuffer += data[key].name;\n                    htmlbuffer += '</a>';\n                    htmlbuffer += '</div>';\n                    $('#livedesk-plugins').append(htmlbuffer);\n                }\n            });\n        },\n\n        unlockItem: function(win) {\n\n            if (!win.closing) {\n                win.closing = true;\n                var url = cfg.wwwroot + '/blocks/livedesk/ajax/service.php?';\n                url += 'action=unlock_item&';\n                url += 'bid=' + livedesk.params['bid'] + '&';\n                url += 'livedeskid=' + livedesk.params['livedeskid'] + '&';\n                url += 'courseid=' + livedesk.params['courseid'] + '&';\n                url += 'messageid=' + win.messageid;\n                $.post(url, function() {\n                    livedesk.refreshGrid();\n                });\n            }\n            return true;\n        },\n\n        discard_post: function() {\n            var postid = livedesk.mygrid.getUserData(livedesk.selectedRow, 'messageid');\n            var url = cfg.wwwroot + '/blocks/livedesk/ajax/service.php?';\n            url += 'action=discard_post&';\n            url += 'bid=' + livedesk.params['bid'] + '&';\n            url += 'livedeskid=' + livedesk.params['livedeskid'] + '&';\n            url += 'courseid=' + livedesk.params['courseid'] + '&';\n            url += 'messageid=' + postid;\n            $.post(url, function() {\n                livedesk.refreshGrid();\n            });\n        }\n    };\n\n    return livedesk;\n\n});"],"names":["define","$","cfg","str","log","livedesk","dhxWins","selectedRow","menu","toolbar","mygrid","init","params","url","dhtmlXWindows","strs","get_strings","key","component","done","s","debug","JSON","stringify","dhtmlXMenuObject","setIconsPath","setSkin","renderAsContextMenu","addNewChild","attachEvent","onContextMenuClick","dhtmlXGridObject","setImagePath","headers","setHeader","setInitWidths","setColAlign","setColTypes","setColSorting","enableContextMenu","wwwroot","load","onBeforeContextMenuHandler","onRowDblClicked","onBeforeContextMenu","layout","dhtmlXLayoutObject","cells","setWidth","setHeight","attachObject","setText","attachToolbar","addButton","bti","addButtonTwoState","setItemToolTip","setItemState","setItemImage","toolbarClickHandler","toolbarStateChange","getMonitoredPlugins","refreshOnlineUsersCount","setInterval","refreshGrid","keepMeAlive","bind","this","find","val","id","selId","reply_post","discard_post","timecreated","getUserData","createWindow","window","setModal","discardiconurl","setIcon","attachURL","hideItem","showItem","item","win","statsiconurl","statsurl","sesskey","location","state","post","_isIE","clearAndLoad","data","clearAll","parse","rId","rowId","itemid","messageid","cmid","randX","Math","floor","random","randY","closing","unlockItem","generateNoty","text","type","noty","timeout","closeWith","dismissQueue","theme","htmlbuffer","users_count","html","attenders_count","append","userlist","i","attenders","length","className","name","blockpixurl","postid"],"mappings":"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"}